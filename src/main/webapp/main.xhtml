<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      lang="#{languageSwitcher.getLocale()}">

<h:head>
    <title>Lab3</title>
    <link rel="icon" type="image/x-icon" href="assets/graph.svg" />
    <h:outputStylesheet library="styles" name="styles.css" />
    <h:outputScript library="dist" name="mainBundle.js" />
</h:head>

<h:body>

    <div id="hat">
        <ui:include src="templates/theme.xhtml" />
        <ui:include src="templates/locales.xhtml" />
    </div>

    <table>
        <tr>
            <td>
                <ui:include src="assets/graph.svg" />
                <div id="svgX">X=</div>
                <div id="svgY">Y=</div>
            </td>
        </tr>

        <tr>
            <td>
                <h:form id="form">
                    <table id="formTable">
                        <tr>
                            <td class="valueMarker">
                                <h:outputText value="X= #{selectXBean.selectedX}" id="xValue"/>
                            </td>
                            <td class="formRow">
                                <ui:repeat value="#{selectableOptions.buttonXValues}" var="value">
                                    <h:commandButton styleClass="valueButton" value="#{value}">
                                        <f:ajax listener="#{selectXBean.toggle(value)}" render="@form xValue"/>
                                    </h:commandButton>
                                </ui:repeat>
                            </td>
                            <td class="leftColumn"/>
                        </tr>

                        <tr>
                            <td class="valueMarker">
                                <h:outputText value="Y= #{selectYBean.y}" id="yValue"/>
                            </td>
                            <td class="formRow">
                                <p:inputNumber id="Ytext" value="#{selectYBean.y}" minValue="-3" maxValue="5" validator="#{selectYBean.validate}">
                                    <f:ajax execute="Ytext" render="@form yValue YMessage"/>
                                </p:inputNumber>
                                <br/>
                                <h:message id="YMessage" for="Ytext" display="text" styleClass="YMessage"/>
                            </td>

                            <td class="leftColumn"/>
                        </tr>

                        <tr>
                            <td class="valueMarker">
                                <h:outputText value="R= #{selectRBean.r}" id="rValue"/>
                            </td>
                            <td class="formRow">
                                <ui:repeat value="#{selectableOptions.linkRValues}" var="value">
                                    <p:commandLink styleClass="valueButton" value="#{value}">
                                        <f:ajax listener="#{selectRBean.updateR(value)}" render="@form rValue"/>
                                    </p:commandLink>
                                </ui:repeat>
                            </td>
                            <td class="leftColumn"/>
                        </tr>

                    </table>

                    <h:commandButton styleClass="submitButton" type="submit" id="submitButton" value="#{msg['index.send']}">
                        <f:ajax execute="@form" listener="#{hitsControllerBean.newHit(selectXBean.selectedX, selectYBean.y, selectRBean.r)}" render="@form resultTable"/>
                    </h:commandButton>
                </h:form>
            </td>
        </tr>

        <tr>
            <td>
                <h:commandButton id="resetTable" value="#{msg['index.reset']}">
                    <f:ajax execute="@form" listener="#{hitsControllerBean.clearHit()}" />
                </h:commandButton>

                <h:dataTable id="resultTable" value="#{hitsControllerBean.hits}" var="hit" styleClass="tableWithBorder">
                    <h:column>
                        <f:facet name = "header">X</f:facet>
                        #{hit.x}
                    </h:column>
                    <h:column>
                        <f:facet name = "header">Y</f:facet>
                        #{hit.y}
                    </h:column>
                    <h:column>
                        <f:facet name = "header">R</f:facet>
                        #{hit.r}
                    </h:column>
                    <h:column>
                        <f:facet name = "header"><h:outputText value="#{msg['index.resultTable.hit']}"/></f:facet>
                        #{hit.hit}
                    </h:column>
                    <h:column>
                        <f:facet name = "header"><h:outputText value="#{msg['index.resultTable.time']}"/></f:facet>
                        #{hit.curr_date}
                    </h:column>
                    <h:column>
                        <f:facet name = "header"><h:outputText value="#{msg['index.resultTable.executionTime']}"/></f:facet>
                        #{hit.exec_time} ms
                    </h:column>
                </h:dataTable>

            </td>
        </tr>

        <tr>
            <td>
                <h:form id="to_start">
                    <h:commandButton action="/start.xhtml?faces-redirect=true" value="#{msg['result.back']}" styleClass="backButton"/>
                </h:form>
            </td>
        </tr>
    </table>

</h:body>
</html>